<!DOCTYPE html>
<html lang="ru"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>НПО Мелодия</title>
  <meta name="description" content="НПО Мелодия — клуб / лейбл / трансляции. Афиша, артисты, релизы, подкасты, live, мерч, контакты.">

  <style>
    @font-face{
      font-family:"ISOCP EUR Italic";
      src:url("ISOCPEUR Italic.ttf") format("truetype");
      font-weight:400;
      font-style:normal;
      font-display:swap;
    }

    :root{
      --bg:#000;
      --fg:#fff;
      --muted:rgba(255,255,255,.72);
      --stroke:rgba(255,255,255,.14);
      --stroke2:rgba(255,255,255,.10);
      --card:rgba(8,8,8,.42);
      --radius:18px;
      --max:1180px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "ISOCP EUR Italic", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", sans-serif;
      font-size:clamp(15px, 0.2vw + 14px, 17px);
      font-weight:400;
      letter-spacing:.01em;
      background:var(--bg);
      color:var(--fg);
      line-height:1.5;
      overflow-x:hidden;
      position:relative;
      isolation:isolate;
    }
    body::before{
      content:"";
      position:fixed;
      inset:0;
      z-index:-2;
      pointer-events:none;
      background-image:url("bg-contour.png");
      background-repeat:no-repeat;
      background-size:cover;
      background-position:center center;
      filter:grayscale(1) invert(1) contrast(3.4) brightness(1.5);
      opacity:.2;
    }
    body::after{
      content:"";
      position:fixed;
      inset:0;
      z-index:-1;
      pointer-events:none;
      background:rgba(0,0,0,.82);
    }
    a{color:inherit;text-decoration:none}
    button,input,textarea,select{font:inherit}
    .container{max-width:var(--max); margin:0 auto; padding:0 18px}

    .topbar{
      position:fixed; inset:0 0 auto 0; z-index:50;
      height:78px;
      backdrop-filter: blur(12px);
      background: rgba(5,5,5,.45);
      border-bottom:1px solid var(--stroke2);
      box-shadow:0 12px 40px rgba(0,0,0,.34);
    }
    .topbar .in{
      height:78px; display:flex; align-items:center; justify-content:space-between; gap:14px;
      flex-wrap:nowrap;
    }
    .topbar .in > *{
      min-width:0;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      font-weight:700;
      letter-spacing:.02em;
      font-size:clamp(28px, 1.7vw, 36px);
      line-height:1;
      flex-shrink:0;
    }
    .brand-name{
      color:var(--fg);
      white-space:nowrap;
      font-size:clamp(31px, 8.1vw, 47px);
      line-height:1;
      text-align:left;
      display:block;
      position:relative;
      top:3px;
    }
    .brand-mark{
      width:42px; height:42px; border-radius:13px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.02);
      display:flex; align-items:center; justify-content:center;
      padding:7px;
      overflow:hidden;
    }
    .brand-mark img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }
    .menu-toggle{
      color:var(--fg);
      cursor:pointer;
      padding:0;
    }
    .mobile-menu-backdrop{
      position:fixed;
      inset:78px 0 0 0;
      background:rgba(0,0,0,.45);
      backdrop-filter:blur(4px);
      z-index:79;
      opacity:0;
      pointer-events:none;
      transition:opacity .18s ease;
    }
    .mobile-menu{
      position:fixed;
      top:78px;
      left:12px;
      right:12px;
      z-index:80;
      border:1px solid var(--stroke);
      border-radius:16px;
      background:rgba(5,5,5,.96);
      padding:10px;
      transform:translateY(-14px);
      opacity:0;
      pointer-events:none;
      transition:transform .18s ease, opacity .18s ease;
    }
    .mobile-menu a{
      display:block;
      padding:11px 12px;
      border-radius:12px;
      color:var(--muted);
      font-size:14px;
      letter-spacing:.02em;
      border:1px solid transparent;
    }
    .mobile-menu a:hover,
    .mobile-menu a:active{
      color:var(--fg);
      background:rgba(255,255,255,.06);
      border-color:var(--stroke2);
    }
    body.menu-open .mobile-menu{
      transform:translateY(0);
      opacity:1;
      pointer-events:auto;
    }
    body.menu-open .mobile-menu-backdrop{
      opacity:1;
      pointer-events:auto;
    }
    .nav{
      display:flex;
      gap:12px;
      align-items:center;
      overflow:auto;
      flex:1 1 auto;
      justify-content:center;
    }
    .nav a{
      color:var(--muted);
      font-size:13px;
      font-weight:520;
      letter-spacing:.02em;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid transparent;
      white-space:nowrap;
    }
    .nav a:hover{color:var(--fg); background:rgba(255,255,255,.04); border-color:var(--stroke2)}
    .nav a.active{color:var(--fg); background:rgba(255,255,255,.08); border-color:var(--stroke)}
    .right{display:flex; gap:10px; align-items:center; flex-shrink:0}

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--fg);
      font-size:13px;
      font-weight:520;
      letter-spacing:.02em;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{transform:translateY(-1px); background:rgba(255,255,255,.10); border-color:rgba(255,255,255,.18)}
    .btn.primary{background:rgba(255,255,255,.14); border-color:rgba(255,255,255,.24)}
    .btn.ghost{background:transparent}
    .btn.sc-btn{
      width:42px;
      min-width:42px;
      height:42px;
      padding:0;
      border-radius:999px;
    }
    .sc-icon{
      width:18px;
      height:18px;
      display:block;
      fill:currentColor;
    }

    main{padding-top:78px}
    section{padding:56px 0; border-bottom:1px solid rgba(255,255,255,.06)}
    .head{display:flex; align-items:flex-end; justify-content:space-between; gap:14px; margin-bottom:18px}
    h1,h2{margin:0}
    h1{font-size: clamp(36px, 4.8vw, 68px); line-height:1.04; letter-spacing:.02em; font-weight:560}
    h2{font-size:clamp(20px, 2vw, 28px); line-height:1.15; letter-spacing:.015em; font-weight:520}
    .sub{margin-top:10px; color:var(--muted); max-width:760px; font-size:clamp(15px, .35vw + 14px, 18px); line-height:1.55}
    b,strong{font-weight:560}

    .grid{display:grid; gap:14px}
    .g2{grid-template-columns: repeat(2, minmax(0,1fr))}
    .g3{grid-template-columns: repeat(3, minmax(0,1fr))}
    .g4{grid-template-columns: repeat(4, minmax(0,1fr))}

    .card{
      border:1px solid var(--stroke2);
      background: var(--card);
      border-radius: var(--radius);
      overflow:hidden;
      backdrop-filter: blur(8px);
      box-shadow:0 12px 36px rgba(0,0,0,.35);
    }
    .open-card{
      cursor:pointer;
      user-select:none;
      transition:background .12s ease, border-color .12s ease, transform .12s ease;
    }
    .open-card:hover{
      background:rgba(255,255,255,.05);
      border-color:rgba(255,255,255,.18);
    }
    .open-card:active,
    .open-card.is-pressed{
      background:rgba(255,255,255,.10);
      border-color:rgba(255,255,255,.24);
      transform:translateY(1px);
    }
    .open-card:focus-visible{
      outline:2px solid rgba(255,255,255,.35);
      outline-offset:2px;
    }
    #artistsGrid .open-card .pad{
      padding:12px;
    }
    #artistsGrid .artist-name{
      display:block;
      white-space:normal;
      overflow:visible;
      text-overflow:clip;
      word-break:break-word;
      line-height:1.2;
    }
    .pad{padding:16px}
    .divider{height:1px; background:var(--stroke2); margin:14px 0}
    .muted{color:var(--muted)}
    .tag{
      display:inline-flex; align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--stroke2);
      background:rgba(255,255,255,.03);
      font-size:11px;
      font-weight:500;
      letter-spacing:.02em;
      color:rgba(255,255,255,.82);
      white-space:nowrap;
    }
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .sp{justify-content:space-between}
    .event-card-title{
      max-width:100%;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .event-card-date{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .event-tags{
      margin-top:10px;
      display:flex;
      gap:8px;
      flex-wrap:nowrap;
      min-height:30px;
    }
    .event-tags .tag{
      min-width:96px;
      justify-content:center;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--stroke2);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
      letter-spacing:.02em;
      white-space:nowrap;
    }
    #streamNext{
      max-width:100%;
      min-width:0;
    }
    .quick-links{margin-top:14px}
    .quick-links .title{
      font-size:13px;
      color:var(--muted);
      margin-bottom:10px;
    }

    /* Hero */
    .hero{padding:58px 0 36px}
    .heroGrid{
      display:grid; gap:16px;
      grid-template-columns: 1.1fr .9fr;
      align-items:stretch;
    }
    .heroArt{
      min-height:420px;
      display:flex; flex-direction:column; justify-content:space-between;
      position:relative;
      border:1px solid var(--stroke2);
      border-radius: var(--radius);
      overflow:hidden;
      background:transparent;
    }
    .heroArt .bg{
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.08), transparent 45%),
        radial-gradient(circle at 70% 80%, rgba(255,255,255,.06), transparent 50%);
      pointer-events:none;
    }
    .heroArt .smile{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      padding:20px;
    }
    .heroArt img{
      width:min(520px, 90%);
      height:auto;
    }
    .hero-main-image{
      width:min(640px, 92%);
      height:auto;
      display:block;
      background:transparent;
    }
    .heroArt .cap{
      position:relative;
      display:flex; justify-content:space-between; align-items:center;
      padding:14px 16px;
      border-top:1px solid var(--stroke2);
      background:rgba(0,0,0,.55);
      color:var(--muted);
      font-size:13px;
    }

    .hero-fullscreen .hero{padding:0}
    .hero-fullscreen .hero .container{max-width:none; padding:0}
    .hero-fullscreen .heroGrid{display:block}
    .hero-fullscreen .heroGrid > div:first-child{display:none}
    .hero-fullscreen .heroArt{
      min-height:calc(100vh - 78px);
      border:0;
      border-radius:0;
    }
    .hero-fullscreen .heroArt .bg,
    .hero-fullscreen .heroArt .cap{display:none}
    .hero-fullscreen .heroArt .smile{padding:0}
    .hero-fullscreen .heroArt .hero-main-image{
      width:100%;
      height:100%;
      max-height:none;
      object-fit:cover;
      object-position:center center;
    }

    .intro-start{
      padding:0;
      min-height:calc(100vh - 78px);
      display:flex;
      align-items:center;
      justify-content:center;
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .intro-start-image{
      width:100%;
      height:100%;
      min-height:calc(100vh - 78px);
      display:block;
      object-fit:cover;
      object-position:center center;
      background:transparent;
      filter:grayscale(1) contrast(0.95) brightness(0.9);
      opacity:.58;
    }

    /* Media blocks (везде одно изображение) */
    .media{
      width:100%;
      aspect-ratio: 4/5;
      border-bottom:1px solid var(--stroke2);
      background:rgba(255,255,255,.02);
      display:flex; align-items:center; justify-content:center;
      padding:12px;
    }
    .media.square{aspect-ratio:1/1}
    .media.wide{aspect-ratio:16/9}
    .media img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      opacity:.98;
    }
    .media.cover{
      padding:0;
    }
    .media.cover img{
      object-fit:cover;
    }

    /* Calendar */
    #calendar .calendar-layout{
      display:grid;
      grid-template-columns:minmax(0, 1.35fr) minmax(320px, .85fr);
      gap:14px;
      align-items:start;
    }
    #calendar .calendar-grid-card{
      padding:14px;
      overflow:visible;
    }
    .calHead{
      display:grid; grid-template-columns: repeat(7, minmax(0,1fr));
      gap:8px; color:rgba(255,255,255,.72); font-size:12px;
      text-transform:uppercase; letter-spacing:.08em
    }
    .calGrid{display:grid; grid-template-columns: repeat(7, minmax(0,1fr)); gap:8px; margin-top:10px}
    .day{
      min-height:74px;
      border:1px solid var(--stroke2);
      border-radius:14px;
      background:rgba(255,255,255,.02);
      padding:9px;
      cursor:pointer;
      transition: transform .08s ease, background .08s ease, border-color .08s ease;
    }
    .day:hover{transform:translateY(-1px); background:rgba(255,255,255,.04); border-color:rgba(255,255,255,.16)}
    .day.disabled{opacity:.35; cursor:default}
    .day.disabled:hover{transform:none}
    .dayNum{font-size:13px; color:rgba(255,255,255,.86)}
    .dots{display:flex; gap:6px; flex-wrap:wrap; margin-top:10px}
    .dot{width:8px; height:8px; border-radius:999px; background:rgba(255,255,255,.70)}
    #calendar .calendar-picked-panel{
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:100%;
    }
    #calendar .calendar-picked-panel > .row.sp{
      display:none;
    }
    #calendar .picked-events-wrap{
      flex:1;
    }
    #calendar .picked-event-empty{
      border:1px dashed var(--stroke2);
      border-radius:14px;
      min-height:170px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:18px;
      color:var(--muted);
    }
    #calendar .picked-event-card{
      border:1px solid var(--stroke2);
      border-radius:14px;
      background:rgba(255,255,255,.02);
      overflow:hidden;
      display:block;
    }
    #calendar .picked-event-media{
      width:100%;
      aspect-ratio:16/10;
      background:rgba(255,255,255,.03);
      border-bottom:1px solid var(--stroke2);
      padding:6px;
    }
    #calendar .picked-event-media img{
      width:100%;
      height:100%;
      object-fit:cover;
      border-radius:8px;
      display:block;
    }
    #calendar .picked-event-body{
      padding:10px 12px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    #calendar .picked-event-title{
      font-size:16px;
      line-height:1.2;
      display:block;
    }
    #calendar .picked-event-date{
      font-size:13px;
    }
    #calendar .picked-event-about{
      font-size:13px;
      line-height:1.35;
    }
    #calendar .picked-event-lineup{
      font-size:12px;
      line-height:1.35;
      max-height:4.1em;
      overflow:hidden;
    }
    #calendar .picked-event-more{
      font-size:12px;
      color:var(--muted);
    }
    #calendar .picked-event-body .btn{
      margin-top:12px;
      width:100%;
    }

    /* Forms */
    .input, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--stroke2);
      background:rgba(255,255,255,.03);
      color:var(--fg);
      outline:none;
    }
    textarea{min-height:110px; resize:vertical}

    footer{padding:24px 0 40px; color:var(--muted); font-size:14px}

    @media (max-width: 1200px){
      .container{padding:0 16px}
      .g4{grid-template-columns:repeat(3, minmax(0,1fr))}
    }
    @media (max-width: 1140px){
      #calendar .calendar-layout{grid-template-columns:1fr}
    }

    @media (max-width: 980px){
      .nav{display:none}
      .heroGrid{grid-template-columns:1fr}
      .g4{grid-template-columns:repeat(2, minmax(0,1fr))}
      .g3{grid-template-columns:repeat(2, minmax(0,1fr))}
      .g2{grid-template-columns:1fr}
      #calendar .calendar-layout{grid-template-columns:1fr}
      .calendar-picked-panel{display:none}
      section{padding:44px 0}
      .day{min-height:80px}
    }

    @media (max-width: 760px){
      #calendar .calendar-picked-panel{
        display:none !important;
      }
      .topbar,
      .topbar .in{height:68px}
      .topbar .in{
        position:relative;
        justify-content:flex-start;
        align-items:center;
      }
      .brand{
        position:static;
        gap:8px;
        align-items:center;
      }
      .brand .brand-mark{
        position:static;
        transform:none;
        width:38px;
        height:38px;
        padding:0;
        border:1px solid var(--stroke);
        border-radius:13px;
        background:rgba(255,255,255,.02);
        overflow:hidden;
      }
      .brand .brand-mark img{
        object-fit:cover;
      }
      .brand-name{
        transform:none;
      }
      .right{
        position:absolute;
        right:0;
        top:50%;
        transform:translateY(-50%);
      }
      main{padding-top:68px}
      .mobile-menu{top:68px}
      .mobile-menu-backdrop{inset:68px 0 0 0}
      .right .btn{padding:9px 12px; font-size:13px}
      h1{font-size:clamp(28px, 8.2vw, 44px); line-height:1.06}
      h2{font-size:clamp(18px, 5.8vw, 22px)}
      body{font-size:15px; line-height:1.45}
      .hero-fullscreen .heroArt{min-height:calc(100vh - 68px)}
      .hero-fullscreen .heroArt .smile{
        width:100%;
        height:100%;
      }
      .hero-fullscreen .heroArt .hero-main-image{
        width:100%;
        height:100%;
        max-height:none;
        object-fit:cover;
        object-position:center 24%;
      }
      #calendar .card.pad,
      #calendar .calendar-grid-card{
        padding:12px;
      }
      #calendar .calHead{
        gap:5px;
        font-size:10px;
      }
      #calendar .calGrid{
        gap:5px;
      }
      #calendar .day{
        min-height:58px;
        padding:6px;
        border-radius:11px;
      }
      #calendar .dayNum{
        font-size:12px;
      }
      #calendar .dots{
        margin-top:6px;
        gap:4px;
      }
      #calendar .dot{
        width:6px;
        height:6px;
      }
      .intro-start,
      .intro-start-image{
        min-height:calc(100vh - 68px);
      }
      .intro-start-image{
        object-position:center 24%;
      }
      #streams .head{
        flex-direction:column;
        align-items:flex-start;
      }
      #streams .head > div{
        width:100%;
        min-width:0;
      }
      #streams .head .row{
        width:100%;
      }
      #streamNext{
        width:100%;
        display:flex;
        white-space:normal;
        overflow-wrap:anywhere;
        line-height:1.25;
      }

      /* Compact mobile cards */
      section{
        padding:24px 0;
      }
      .card{
        border-radius:12px;
      }
      .pad{
        padding:10px;
      }
      .row{
        gap:6px;
      }
      .tag{
        font-size:10px;
        padding:4px 7px;
      }
      .btn{
        font-size:11px;
        padding:6px 10px;
      }
      .media{
        aspect-ratio:1/1;
        padding:6px;
      }
      .media.wide{
        aspect-ratio:4/3;
      }
      .muted{
        font-size:12px;
      }
      #eventsGrid,
      #artistsGrid,
      #releasesGrid,
      #merchGrid{
        grid-template-columns:repeat(2, minmax(0,1fr)) !important;
        gap:8px;
      }
      #podcastsGrid,
      #streamsList{
        gap:8px;
      }
    }

    @media (max-width: 520px){
      .container{padding:0 14px}
      .g4{grid-template-columns:1fr}
      .g3{grid-template-columns:1fr}
      .heroArt{min-height:360px}
      .hero-fullscreen .hero .container{padding:0}
      .right .afisha-btn{display:none}
      .calHead{font-size:11px}
      .calGrid{gap:6px}
      .day{min-height:52px; padding:5px}
      .pill{font-size:11px}
      #streamNext{font-size:11px; padding:6px 9px}

      /* Keep compact grids on very small screens */
      #eventsGrid,
      #artistsGrid,
      #releasesGrid,
      #merchGrid{
        grid-template-columns:repeat(2, minmax(0,1fr)) !important;
      }
      .media{
        aspect-ratio:1/1;
      }
      .pad{
        padding:8px;
      }
    }

    @media (max-width: 380px){
      .brand{gap:9px}
      .brand-name{font-size:31px}
      .brand-mark{width:36px; height:36px; font-size:19px}
      .btn{padding:8px 11px; font-size:13px}
      .tag{padding:5px 8px}
      .mobile-menu a{font-size:13px}
    }

    @media (max-height: 700px){
      section{padding:34px 0}
      .hero-fullscreen .heroArt{min-height:calc(100vh - 68px)}
    }
  </style>
</head>

<body class="hero-fullscreen">
<header class="topbar">
  <div class="container">
    <div class="in">
      <div class="brand">
        <button class="brand-mark menu-toggle" id="mobileMenuToggle" type="button" aria-label="Открыть меню" aria-expanded="false">
          <img src="smile.png" alt="Логотип НПО Мелодия">
        </button>
        <a class="brand-name" href="#home">НПО Мелодия</a>
      </div>

      <nav class="nav" aria-label="Навигация">
        <a href="#events">Ивенты</a>
        <a href="#calendar">Календарь</a>
        <a href="#artists">Артисты</a>
        <a href="#releases">Релизы</a>
        <a href="#streams">Трансляции</a>
        <a href="#merch">Мерч</a>
        <a href="#contacts">Контакты</a>
      </nav>

      <div class="right">
        <a class="btn sc-btn" href="https://soundcloud.com/npo_radio?utm_source=clipboard&utm_medium=text&utm_campaign=social_sharing" target="_blank" rel="noopener noreferrer" aria-label="SoundCloud">
          <svg class="sc-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3.56 11.97a.8.8 0 0 0-.8.8v4.46a.8.8 0 1 0 1.6 0v-4.46a.8.8 0 0 0-.8-.8Zm2.52-1.37a.8.8 0 0 0-.8.8v5.83a.8.8 0 0 0 1.6 0V11.4a.8.8 0 0 0-.8-.8Zm2.52-.82a.8.8 0 0 0-.8.8v6.65a.8.8 0 1 0 1.6 0v-6.65a.8.8 0 0 0-.8-.8Zm2.52.44a.8.8 0 0 0-.8.8v6.21a.8.8 0 1 0 1.6 0v-6.21a.8.8 0 0 0-.8-.8Zm2.52 1.25a.8.8 0 0 0-.8.8v4.96a.8.8 0 0 0 1.6 0v-4.96a.8.8 0 0 0-.8-.8Zm1.91 6.56h4.11a2.94 2.94 0 1 0-.34-5.86 4.88 4.88 0 0 0-9.53-.76.8.8 0 0 0 1.49.58 3.28 3.28 0 0 1 6.36.84v.18a.8.8 0 0 0 .96.78c.18-.03.35-.05.52-.05a1.34 1.34 0 1 1 0 2.68h-4.11a.8.8 0 1 0 0 1.6Z"/>
          </svg>
        </a>
        <a class="btn primary" href="#streams">Live</a>
      </div>
    </div>
  </div>
</header>
<div class="mobile-menu-backdrop" id="mobileMenuBackdrop" hidden></div>
<nav class="mobile-menu" id="mobileMenu" aria-label="Мобильная навигация" hidden>
  <a href="#events">Ивенты</a>
  <a href="#calendar">Календарь</a>
  <a href="#artists">Артисты</a>
  <a href="#releases">Релизы</a>
  <a href="#streams">Трансляции</a>
  <a href="#merch">Мерч</a>
  <a href="#contacts">Контакты</a>
</nav>

<main>

  <!-- INTRO -->
  <section class="intro-start" id="home">
    <img class="intro-start-image" src="npo_print_source.png" alt="Изображение">
  </section>

  <!-- EVENTS -->
  <section id="events">
    <div class="container">
      <div class="head">
        <div>
          <h2>АФИША</h2>
        </div>
        <div class="row">
        </div>
      </div>

      <div class="grid g4" id="eventsGrid"></div>
    </div>
  </section>

  <!-- CALENDAR -->
  <section id="calendar">
    <div class="container">
      <div class="head">
        <div>
          <h2>Календарь</h2>
          <div class="sub">Месячная сетка</div>
        </div>
        <div class="row">
          <button class="btn" id="prevMonth" type="button">←</button>
          <span class="pill" id="monthLabel">Февраль 2026</span>
          <button class="btn" id="nextMonth" type="button">→</button>
        </div>
      </div>

      <div class="calendar-layout">
        <div class="card calendar-grid-card">
          <div class="calHead" id="calHead"><div>Пн</div><div>Вт</div><div>Ср</div><div>Чт</div><div>Пт</div><div>Сб</div><div>Вс</div></div>
          <div class="calGrid" id="calGrid"></div>
        </div>

        <div class="card calendar-picked-panel">
          <div class="row sp">
            <div>
              <b id="pickedDayLabel">Выбери день</b>
              <div class="muted" id="pickedDayHint" style="margin-top:6px;">События появятся здесь</div>
            </div>
            <button class="btn" id="clearPicked" type="button">Сброс</button>
          </div>
          <div id="pickedEvents" class="picked-events-wrap"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- ARTISTS -->
  <section id="artists">
    <div class="container">
      <div class="head">
        <div>
          <h2>Артисты &amp; букинг</h2>
          <div class="sub">тестовый каталог</div>
        </div>
      </div>

      <div class="card">
        <div class="pad">
          <div class="grid g4" id="artistsGrid"></div>
        </div>
      </div>

    </div>
  </section>

  <!-- RELEASES -->
  <section id="releases">
    <div class="container">
      <div class="head">
        <div>
          <h2>Релизы</h2>
        </div>
      </div>

      <div class="card">
        <div class="pad">
          <div class="grid g4" id="releasesGrid"></div>
        </div>
      </div>

    </div>
  </section>

  <!-- STREAMS -->
  <section id="streams">
    <div class="container">
      <div class="head">
        <div>
          <h2>Трансляции</h2>
          <div class="sub">Live + архив. Сейчас все тестово.</div>
        </div>
        <div class="row">
          <span class="pill" id="streamNext">Следующий эфир: Warehouse Night · 07.03.2026 23:00</span>
        </div>
      </div>

      <div class="grid g2">
        <div class="card">
          <div class="pad">
            <div class="row sp">
              <b>Live</b>
              <span class="tag">placeholder</span>
            </div>
          </div>
          <div class="divider" style="margin:0;"></div>
          <div class="pad">
            <div class="media wide"><img src="smile.png" alt=""></div>
          </div>
        </div>

        <div class="card pad">
          <div class="row sp">
            <b>Архив</b>
            <span class="tag">3 записи</span>
          </div>
          <div class="divider"></div>
          <div class="grid" id="streamsList"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- MERCH -->
  <section id="merch">
    <div class="container">
      <div class="head">
        <div>
          <h2>Мерч</h2>
          <div class="sub">Каталог (тест)</div>
        </div>
        <div class="row">
          <span class="pill">оплата: позже</span>
        </div>
      </div>

      <div class="grid g4" id="merchGrid"></div>
    </div>
  </section>

  <!-- CONTACTS -->
  <section id="contacts">
    <div class="container">
      <div class="head">
        <div>
          <h2>Контакты</h2>
        </div>
      </div>

      <div class="grid g2">
        <div class="card pad">
          <b>НПО Мелодия</b>
          <div class="divider"></div>
          <div class="row"><span class="tag">Адрес</span><span class="muted">Paris, test street 12</span></div>
          <div style="height:10px"></div>
          <div class="row"><span class="tag">Букинг</span><span class="muted">booking@npo-melodiya.test</span></div>
          <div style="height:10px"></div>
          <div class="row"><span class="tag">Пресса</span><span class="muted">press@npo-melodiya.test</span></div>
          <div class="divider"></div>
          <div class="row">
            <a class="btn" href="#" onclick="alert(&#39;Поставь ссылку&#39;); return false;">Telegram</a>
            <a class="btn" href="#" onclick="alert(&#39;Поставь ссылку&#39;); return false;">Instagram</a>
            <a class="btn" href="#" onclick="alert(&#39;Поставь ссылку&#39;); return false;">SoundCloud</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">© <span id="year">2026</span> НПО Мелодия · тестовый прототип</div>
  </footer>

</main>

<!-- MODAL -->
<div id="modal" style="
  position:fixed; inset:0; z-index:100; display:none;
  align-items:center; justify-content:center; padding:18px;
  background: rgba(0,0,0,.70); backdrop-filter: blur(8px);
">
  <div style="
    width:min(920px, 100%); max-height:86vh; overflow:auto;
    border-radius:20px; border:1px solid var(--stroke);
    background:#060606;
  ">
    <div style="display:flex; justify-content:space-between; gap:12px; padding:14px 16px; border-bottom:1px solid var(--stroke2);">
      <div>
        <div id="mTitle" style="font-weight:800; letter-spacing:.2px;">—</div>
        <div id="mSub" class="muted" style="margin-top:6px; font-size:13px;">—</div>
      </div>
      <button class="btn" id="mClose" type="button">Закрыть</button>
    </div>
    <div class="pad" id="mBody"></div>
  </div>
</div>

<script>
  // IMPORTANT:
  // 1) Сохрани твою картинку рядом с index.html
  // 2) Назови файл smile.png (или поменяй все src="smile.png" на свое имя)

  const $ = (s, r=document)=>r.querySelector(s);
  const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));
  const pad2 = n => String(n).padStart(2,"0");
  const fmtDT = (iso) => {
    const d = new Date(iso);
    return `${pad2(d.getDate())}.${pad2(d.getMonth()+1)}.${d.getFullYear()} ${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
  };
  const monthRU = m => ["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][m];
  const weekRU = ["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];
  const sortAsc = (arr, key)=>[...arr].sort((a,b)=>new Date(a[key])-new Date(b[key]));

  const data = {
    events: [
      { id:"e1", title:"Maslaynitsa", date:"2026-02-19T22:00:00", place:"НПО Мелодия", tags:["live", "electronic"], status:"archive", poster:"event-maslaynitsa.jpg", about:"Ивент Maslaynitsa.", lineup:["am1d", "di-au", "feel gainsbourg", "egor popov", "nyaono"] },
      { id:"e2", title:"Cliche", date:"2026-02-20T22:00:00", place:"НПО Мелодия", tags:["club", "b2b"], status:"archive", poster:"event-cliche.jpg", about:"Ночной ивент Cliche.", lineup:["ayokiddy", "fckshizy", "luxxomea", "manyice", "norman b2b void", "whysobored", "yardyard"] },
      { id:"e3", title:"Pirate Jet", date:"2026-02-28T20:00:00", place:"НПО Мелодия", tags:["live", "concert"], status:"archive", poster:"event-pirate-jet.jpg", about:"Pirate Jet: концерты и live performance.", lineup:["gummies (concert)", "черные бояре x света ефремова (live performance)", "m1lbeee (concert)", "ucuda (concert)", "фантом м-100 (live)", "valentin fufaev", "dj baby steps", "yze (concert)", "bogdamn"] },
      { id:"e4", title:"8 Марта — Первый уикенд весны", date:"2026-03-08T21:30:00", place:"НПО Мелодия", tags:["weekend", "live", "32h"], status:"tickets", poster:"event-8-marta.jpg", ticketUrl:"https://moscow.qtickets.events/219423-78", about:"Первый уикенд весны — 32 часа. День 1. Двери: 21:30.", lineup:["Line-up скоро"] },
      { id:"e5", title:"9 Марта — Первый уикенд весны (день 2)", date:"2026-03-09T17:00:00", place:"НПО Мелодия", tags:["weekend", "8march"], status:"tickets", poster:"event-8-marta.jpg", ticketUrl:"https://moscow.qtickets.events/219423-78", about:"Продолжение уикенда весны. День 2. Полный анонс по лайнапу — скоро.", lineup:["Line-up скоро"] },
    ],
    artists: [
      { id:"a2", name:"AND", role:"Live act", bookable:true, tags:["live","hardware"], bio:"Живой сет с железом." },
      { id:"a3", name:"WEI", role:"DJ / live", bookable:true, tags:["live", "octatrack"], bio:"WEI", poster:"wei.jpg" },
      { id:"a4", name:"ZED", role:"DJ / guest", bookable:true, tags:["industrial","fast"], bio:"Индастриал/фаст." },
      { id:"a5", name:"LATY", role:"Selector", bookable:true, tags:["breaks","leftfield"], bio:"Лефтфилд селекция." },
      { id:"a6", name:"RHA", role:"Podcast host", bookable:true, tags:["talk","curation"], bio:"Ведущий подкаста." },
    ],
    releases: [
      { id:"r1", title:"NPO VA 001", date:"2026-02-28", format:"digital", tracklist:["Track 1","Track 2","Track 3"] },
      { id:"r2", title:"KIRA - Night Tools EP", date:"2026-03-15", format:"vinyl", tracklist:["A1","A2","B1","B2"] },
      { id:"r3", title:"NPO LIVE - Session Cuts", date:"2026-03-22", format:"digital", tracklist:["Cut 1","Cut 2"] },
    ],
    podcasts: [
      { id:"p1", title:"NPO Podcast 01: GUEST A", date:"2026-02-18", note:"Разговор + сет." },
      { id:"p2", title:"NPO Podcast 02: KIRA", date:"2026-03-05", note:"Сет + треклист." },
    ],
    streams: [
      { id:"s1", title:"Replay: Warehouse Night", date:"2026-02-10" },
      { id:"s2", title:"Replay: Guest Session", date:"2026-02-03" },
      { id:"s3", title:"Replay: Community Night", date:"2026-01-27" },
    ],
    merch: [
      { id:"m1", title:"T-shirt NPO", price:"3500 ₽", status:"preorder", desc:"Плотный хлопок, белый принт." },
      { id:"m2", title:"Cap NPO", price:"1900 ₽", status:"in_stock", desc:"Вышивка." },
      { id:"m3", title:"Sticker pack", price:"450 ₽", status:"in_stock", desc:"Набор наклеек." },
      { id:"m4", title:"Totebag", price:"2400 ₽", status:"preorder", desc:"Хлопок, трафарет." },
    ]
  };

  let showUpcoming = false;

  function renderEvents(){
    const wrap = $("#eventsGrid");
    wrap.innerHTML = "";
    const now = new Date();
    let list = sortAsc(data.events, "date");
    if(showUpcoming) {
      list = list.filter(e => new Date(e.date) >= now);
    } else {
      const upcoming = list.filter(e => new Date(e.date) >= now);
      const past = list.filter(e => new Date(e.date) < now).reverse();
      list = [...upcoming, ...past];
    }

    list.forEach((e)=>{
      const eventTags = (e.tags || []).slice(0,2);
      const el = document.createElement("div");
      el.className = "card";
      el.innerHTML = `
        <div class="media"><img src="${e.poster || "smile.png"}" alt="${e.title}" /></div>
        <div class="pad">
          <div class="row sp">
            <b class="event-card-title">${e.title}</b>
          </div>
          <div class="muted event-card-date" style="margin-top:6px;">${fmtDT(e.date)} · ${e.place}</div>
          <div class="event-tags">
            ${eventTags.map(t=>`<span class="tag">${t}</span>`).join("")}
          </div>
        </div>
      `;
      setupOpenCard(el, "event", e.id);
      wrap.appendChild(el);
    });

    const next = sortAsc(data.events, "date").filter(e=>new Date(e.date)>=now)[0];
    const nextEventPill = $("#nextEventPill");
    if (nextEventPill) {
      nextEventPill.textContent = next ? `Следующий ивент: ${next.title} · ${fmtDT(next.date)}` : "Следующий ивент: —";
    }
  }

  const toggleUpcomingBtn = $("#toggleUpcoming");
  if (toggleUpcomingBtn) {
    toggleUpcomingBtn.addEventListener("click", ()=>{
      showUpcoming = !showUpcoming;
      toggleUpcomingBtn.textContent = `Показать: ${showUpcoming ? "ближайшие" : "все"}`;
      renderEvents();
    });
  }

  let viewY = new Date().getFullYear();
  let viewM = new Date().getMonth();
  const mobileCalendarBp = window.matchMedia("(max-width: 760px)");
  function setupOpenCard(el, type, id){
    if(!el) return;
    el.classList.add("open-card");
    el.dataset.open = type;
    el.dataset.id = id;
    el.tabIndex = 0;
    el.setAttribute("role", "button");
    el.addEventListener("pointerdown", ()=>el.classList.add("is-pressed"));
    ["pointerup","pointerleave","pointercancel","blur"].forEach((evt)=>{
      el.addEventListener(evt, ()=>el.classList.remove("is-pressed"));
    });
    el.addEventListener("keydown", (ev)=>{
      if(ev.key === "Enter" || ev.key === " "){
        ev.preventDefault();
        el.click();
      }
    });
  }

  function getEventsByDay(yy, mm, dd){
    return data.events
      .filter(e=>{
        const ed = new Date(e.date);
        return ed.getFullYear()===yy && (ed.getMonth()+1)===mm && ed.getDate()===dd;
      })
      .sort((a,b)=>new Date(a.date)-new Date(b.date));
  }

  function renderPickedEventCard(list){
    const wrap = $("#pickedEvents");
    wrap.innerHTML = "";
    if(!list.length){
      wrap.innerHTML = `
        <div class="picked-event-empty">
          <b>Нет выбранного события</b>
          <div style="margin-top:6px;">Нажми на дату в календаре</div>
        </div>
      `;
      return;
    }

    const e = list[0];
    const moreCount = list.length - 1;
    const lineup = e.lineup || [];
    const lineupPreview = lineup.slice(0, 4).join(", ");
    const lineupTail = lineup.length > 4 ? ` +${lineup.length - 4}` : "";

    const card = document.createElement("article");
    card.className = "picked-event-card";
    card.innerHTML = `
      <div class="picked-event-media"><img src="${e.poster || "smile.png"}" alt="${e.title}" /></div>
      <div class="picked-event-body">
        <b class="picked-event-title">${e.title}</b>
        <div class="muted picked-event-date">${fmtDT(e.date)} · ${e.place}</div>
        ${e.about ? `<div class="muted picked-event-about">${e.about}</div>` : ``}
        ${lineup.length ? `<div class="muted picked-event-lineup"><b>Лайнап:</b> ${lineupPreview}${lineupTail}</div>` : ``}
        ${moreCount > 0 ? `<div class="picked-event-more">+ ещё ${moreCount} событие(й) в этот день</div>` : ``}
      </div>
    `;
    setupOpenCard(card, "event", e.id);
    wrap.appendChild(card);
  }

  function renderCal(){
    $("#monthLabel").textContent = `${monthRU(viewM)} ${viewY}`;
    $("#calHead").innerHTML = weekRU.map(w=>`<div>${w}</div>`).join("");

    const grid = $("#calGrid");
    grid.innerHTML = "";

    const first = new Date(viewY, viewM, 1);
    const last = new Date(viewY, viewM+1, 0);
    const firstDow = (first.getDay()+6)%7;
    const total = last.getDate();

    const map = new Map();
    data.events.forEach(e=>{
      const d = new Date(e.date);
      if(d.getFullYear()===viewY && d.getMonth()===viewM){
        const key = `${viewY}-${pad2(viewM+1)}-${pad2(d.getDate())}`;
        if(!map.has(key)) map.set(key, []);
        map.get(key).push(e);
      }
    });

    for(let i=0;i<firstDow;i++){
      const b = document.createElement("div");
      b.className = "day disabled";
      grid.appendChild(b);
    }

    for(let day=1; day<=total; day++){
      const key = `${viewY}-${pad2(viewM+1)}-${pad2(day)}`;
      const list = map.get(key) || [];
      const el = document.createElement("div");
      el.className = "day";
      el.dataset.key = key;
      el.innerHTML = `
        <div class="row sp" style="align-items:flex-start;">
          <div class="dayNum">${day}</div>
          ${list.length ? `<span class="tag">${list.length}</span>` : ``}
        </div>
        <div class="dots">${list.slice(0,8).map(()=>`<span class="dot"></span>`).join("")}</div>
      `;
      el.addEventListener("click", ()=>pickDay(key));
      grid.appendChild(el);
    }
  }

  function pickDay(key){
    const [yy,mm,dd] = key.split("-").map(Number);
    const d = new Date(yy, mm-1, dd);
    const dayLabel = `События: ${pad2(d.getDate())}.${pad2(d.getMonth()+1)}.${d.getFullYear()}`;
    $("#pickedDayLabel").textContent = dayLabel;

    const list = getEventsByDay(yy, mm, dd);

    if(!list.length){
      $("#pickedDayHint").textContent = "В этот день ивентов нет";
      renderPickedEventCard([]);
      return;
    }
    $("#pickedDayHint").textContent = `Событий: ${list.length}`;
    renderPickedEventCard(list);
    if (mobileCalendarBp.matches && list[0]) {
      openEventModal(list[0]);
    }
  }

  function clearPicked(){
    $("#pickedDayLabel").textContent = "Выбери день";
    $("#pickedDayHint").textContent = "События появятся здесь";
    renderPickedEventCard([]);
  }

  $("#prevMonth").addEventListener("click", ()=>{
    viewM--; if(viewM<0){viewM=11; viewY--;}
    renderCal(); clearPicked();
  });
  $("#nextMonth").addEventListener("click", ()=>{
    viewM++; if(viewM>11){viewM=0; viewY++;}
    renderCal(); clearPicked();
  });
  $("#clearPicked").addEventListener("click", clearPicked);

  function renderArtists(){
    const searchEl = $("#artistSearch");
    const q = ((searchEl && searchEl.value) || "").trim().toLowerCase();
    const wrap = $("#artistsGrid");
    wrap.innerHTML = "";
    const artistLimit = 6;

    let list = [...data.artists].sort((a,b)=>{
      if (a.name === "WEI" && b.name !== "WEI") return -1;
      if (b.name === "WEI" && a.name !== "WEI") return 1;
      return a.name.localeCompare(b.name);
    });
    if(q){
      list = list.filter(a =>
        a.name.toLowerCase().includes(q) ||
        a.role.toLowerCase().includes(q) ||
        (a.tags||[]).join(" ").toLowerCase().includes(q)
      );
    }
    list = list.slice(0, artistLimit);

    list.forEach((a)=>{
      const el = document.createElement("div");
      el.className = "card";
      el.innerHTML = `
        <div class="media square ${a.id === "a3" ? "cover" : ""}"><img src="${a.poster || "smile.png"}" alt="${a.name}" /></div>
        <div class="pad">
          <b class="artist-name">${a.name}</b>
        </div>
      `;
      setupOpenCard(el, "artist", a.id);
      wrap.appendChild(el);
    });
  }

  function renderReleases(){
    const wrap = $("#releasesGrid");
    wrap.innerHTML = "";
    [...data.releases].sort((a,b)=>b.date.localeCompare(a.date)).forEach((r)=>{
      const el = document.createElement("div");
      el.className = "card";
      el.innerHTML = `
        <div class="media square"><img src="smile.png" alt="" /></div>
        <div class="pad">
          <div class="row sp">
            <b style="max-width:70%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${r.title}</b>
            <span class="tag">${r.format}</span>
          </div>
          <div class="muted" style="margin-top:6px;">${r.date}</div>
        </div>
      `;
      setupOpenCard(el, "release", r.id);
      wrap.appendChild(el);
    });
  }

  function renderStreams(){
    const wrap = $("#streamsList");
    wrap.innerHTML = "";
    data.streams.forEach((s)=>{
      const row = document.createElement("div");
      row.className = "card pad";
      row.innerHTML = `
        <div class="row sp">
          <b style="max-width:72%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${s.title}</b>
          <span class="tag">${s.date}</span>
        </div>
      `;
      setupOpenCard(row, "stream", s.id);
      wrap.appendChild(row);
    });

    const now = new Date();
    const next = sortAsc(data.events,"date").filter(e=>new Date(e.date)>=now)[0];
    $("#streamNext").textContent = next ? `Следующий эфир: ${next.title} · ${fmtDT(next.date)}` : "Следующий эфир: —";
  }

  function renderMerch(){
    const wrap = $("#merchGrid");
    wrap.innerHTML = "";
    data.merch.forEach((m)=>{
      const el = document.createElement("div");
      el.className = "card";
      el.innerHTML = `
        <div class="media square"><img src="smile.png" alt="" /></div>
        <div class="pad">
          <div class="row sp">
            <b>${m.title}</b>
            <span class="tag">${m.status}</span>
          </div>
          <div class="muted" style="margin-top:6px;">${m.price}</div>
        </div>
      `;
      setupOpenCard(el, "merch", m.id);
      wrap.appendChild(el);
    });
  }

  // Modal
  const modal = $("#modal");
  const openModal = ({title, sub, body})=>{
    $("#mTitle").textContent = title || "—";
    $("#mSub").textContent = sub || "";
    $("#mBody").innerHTML = body || "";
    modal.style.display = "flex";
  };
  const openEventModal = (ev)=>{
    if (!ev) return;
    openModal({
      title: ev.title,
      sub: `${fmtDT(ev.date)} · ${ev.place}`,
      body: `
          <div class="grid g2">
            <div class="card">
              <div class="media"><img src="${ev.poster || "smile.png"}" alt="${ev.title}" /></div>
              <div class="pad">
                <div class="row">${ev.tags.map(t=>`<span class="tag">${t}</span>`).join("")}</div>
                <div class="divider"></div>
                <b>Описание</b>
                <div class="muted" style="margin-top:8px;">${ev.about}</div>
              </div>
            </div>
            <div class="card pad">
              <b>Лайнап</b>
              <div class="divider"></div>
              <div class="muted">${(ev.lineup||[]).join("<br>")}</div>
              <div class="divider"></div>
              <div class="row sp">
                <span class="tag">${ev.status}</span>
                ${ev.ticketUrl
                  ? `<a class="btn primary" href="${ev.ticketUrl}" target="_blank" rel="noopener noreferrer">Билеты / регистрация</a>`
                  : `<button class="btn primary" type="button" onclick="alert('Тут будет ссылка на билеты/регистрацию')">Билеты / регистрация</button>`
                }
              </div>
            </div>
          </div>
        `
    });
  };
  const closeModal = ()=>{ modal.style.display="none"; };
  $("#mClose").addEventListener("click", closeModal);
  modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });

  document.addEventListener("click", (e)=>{
    const b = e.target.closest("[data-open]");
    if(!b) return;
    const type = b.dataset.open;
    const id = b.dataset.id;

    if(type==="event"){
      const ev = data.events.find(x=>x.id===id);
      openEventModal(ev);
      return;
    }

    if(type==="artist"){
      const a = data.artists.find(x=>x.id===id);
      openModal({
        title: a.name,
        sub: `${a.role} · ${a.bookable ? "доступен для букинга" : "не на букинге"}`,
        body: `
          <div class="grid g2">
            <div class="card">
              <div class="media square ${a.poster ? "cover" : ""}"><img src="${a.poster || "smile.png"}" alt="${a.name}" /></div>
              <div class="pad">
                <div class="row">${a.tags.map(t=>`<span class="tag">${t}</span>`).join("")}</div>
                <div class="divider"></div>
                <b>Bio</b>
                <div class="muted" style="margin-top:8px;">${a.bio}</div>
              </div>
            </div>
            <div class="card pad">
              <b>Букинг</b>
              <div class="divider"></div>
              <div class="muted" style="margin-bottom:10px;">Заполни форму и отправь заявку.</div>
              <form class="grid booking-form-modal" data-artist-id="${a.id}" data-artist-name="${a.name}" data-artist-bookable="${a.bookable ? "1" : "0"}" style="gap:10px;">
                <input class="input" name="date" placeholder="Дата (например 14.03.2026)" required>
                <input class="input" name="city" placeholder="Город" required>
                <input class="input" name="venue" placeholder="Площадка / клуб" required>
                <input class="input" name="format" placeholder="Формат (DJ / live / hybrid)" required>
                <input class="input" name="contacts" placeholder="Контакты (telegram/email)" required>
                <textarea name="note" placeholder="Комментарий (опционально)"></textarea>
                <button class="btn primary" type="submit">Отправить заявку</button>
                <div class="muted booking-status" style="font-size:13px;">Ожидание отправки</div>
              </form>
            </div>
          </div>
        `
      });
      return;
    }

    if(type==="release"){
      const r = data.releases.find(x=>x.id===id);
      openModal({
        title: r.title,
        sub: `${r.date} · ${r.format}`,
        body: `
          <div class="grid g2">
            <div class="card">
              <div class="media square"><img src="smile.png" alt="" /></div>
              <div class="pad">
                <b>Треклист</b>
                <div class="divider"></div>
                <div class="muted">${(r.tracklist||[]).map(t=>`• ${t}`).join("<br>")}</div>
              </div>
            </div>
            <div class="card pad">
              <b>Ссылки</b>
              <div class="divider"></div>
              <div class="row">
                <button class="btn" type="button" onclick="alert('Bandcamp (поставишь ссылку)')">Bandcamp</button>
                <button class="btn" type="button" onclick="alert('SoundCloud (поставишь ссылку)')">SoundCloud</button>
              </div>
              <div class="divider"></div>
              <div class="muted">Кредиты: мастеринг / арт / лейбл (тест).</div>
            </div>
          </div>
        `
      });
      return;
    }

    if(type==="podcast"){
      const p = data.podcasts.find(x=>x.id===id);
      openModal({
        title: p.title,
        sub: `${p.date}`,
        body: `
          <div class="grid g2">
            <div class="card pad">
              <b>Плеер</b>
              <div class="divider"></div>
              <div class="media wide"><img src="smile.png" alt="" /></div>
              <div class="muted" style="margin-top:10px;">Здесь будет SoundCloud embed.</div>
            </div>
            <div class="card pad">
              <b>Описание</b>
              <div class="divider"></div>
              <div class="muted">${p.note}</div>
              <div class="divider"></div>
              <b>Треклист</b>
              <div class="muted" style="margin-top:8px;">Тест: • Track A • Track B • Track C</div>
            </div>
          </div>
        `
      });
      return;
    }

    if(type==="stream"){
      const s = data.streams.find(x=>x.id===id);
      openModal({
        title: s.title,
        sub: `${s.date}`,
        body: `
          <div class="card pad">
            <b>Воспроизведение</b>
            <div class="divider"></div>
            <div class="media wide"><img src="smile.png" alt="" /></div>
            <div class="muted" style="margin-top:10px;">Тут будет YouTube/Vimeo embed.</div>
          </div>
        `
      });
      return;
    }

    if(type==="merch"){
      const m = data.merch.find(x=>x.id===id);
      openModal({
        title: m.title,
        sub: `${m.price} · ${m.status}`,
        body: `
          <div class="grid g2">
            <div class="card">
              <div class="media square"><img src="smile.png" alt="" /></div>
              <div class="pad">
                <b>Описание</b>
                <div class="divider"></div>
                <div class="muted">${m.desc}</div>
              </div>
            </div>
            <div class="card pad">
              <b>Оформление</b>
              <div class="divider"></div>
              <div class="muted">Пока предзаказ. Потом подключим оплату.</div>
              <div style="height:12px"></div>
              <button class="btn primary" type="button" onclick="alert('Тут будет форма/бот')">Предзаказ</button>
            </div>
          </div>
        `
      });
      return;
    }
  });

  // Booking form -> admin endpoint
  const BOOKING_ADMIN_ENDPOINT = "";
  document.addEventListener("submit", async (e)=>{
    const bookingForm = e.target.closest(".booking-form-modal");
    if(!bookingForm) return;
    e.preventDefault();
    const bookingStatus = $(".booking-status", bookingForm);
    const bookingSubmit = bookingForm.querySelector('button[type="submit"]');

    if(!BOOKING_ADMIN_ENDPOINT){
      if (bookingStatus) bookingStatus.textContent = "Добавь URL админки в BOOKING_ADMIN_ENDPOINT";
      return;
    }
    if(bookingForm.dataset.artistBookable !== "1"){
      if (bookingStatus) bookingStatus.textContent = "Этот артист сейчас не на букинге";
      return;
    }

    const payload = {
      artistId: bookingForm.dataset.artistId || "",
      artistName: bookingForm.dataset.artistName || "",
      date: bookingForm.elements.date.value.trim(),
      city: bookingForm.elements.city.value.trim(),
      venue: bookingForm.elements.venue.value.trim(),
      format: bookingForm.elements.format.value.trim(),
      contacts: bookingForm.elements.contacts.value.trim(),
      note: bookingForm.elements.note.value.trim(),
      source: "npo-melodiya-site",
      createdAt: new Date().toISOString()
    };

    if (bookingStatus) bookingStatus.textContent = "Отправка...";
    if (bookingSubmit) bookingSubmit.disabled = true;

    try{
      const res = await fetch(BOOKING_ADMIN_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      if (bookingStatus) bookingStatus.textContent = "Заявка отправлена в админку";
      bookingForm.reset();
    }catch(err){
      if (bookingStatus) bookingStatus.textContent = "Ошибка отправки. Проверь URL админки.";
      console.error(err);
    }finally{
      if (bookingSubmit) bookingSubmit.disabled = false;
    }
  });

  // Nav active on scroll
  const navLinks = $$(".nav a");
  const sections = navLinks.map(a => document.querySelector(a.getAttribute("href"))).filter(Boolean);
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(entry=>{
      if(entry.isIntersecting){
        navLinks.forEach(l=>l.classList.toggle("active", l.getAttribute("href") === `#${entry.target.id}`));
      }
    });
  }, { rootMargin:"-50% 0px -45% 0px", threshold:0.01 });
  sections.forEach(s=>io.observe(s));

  // Mobile menu
  const mobileMenuToggle = $("#mobileMenuToggle");
  const mobileMenu = $("#mobileMenu");
  const mobileMenuBackdrop = $("#mobileMenuBackdrop");
  const mobileLinks = $$("#mobileMenu a");
  const mobileBp = window.matchMedia("(max-width: 980px)");

  const closeMobileMenu = ()=>{
    document.body.classList.remove("menu-open");
    mobileMenuToggle?.setAttribute("aria-expanded", "false");
  };

  const openMobileMenu = ()=>{
    mobileMenu.hidden = false;
    mobileMenuBackdrop.hidden = false;
    document.body.classList.add("menu-open");
    mobileMenuToggle?.setAttribute("aria-expanded", "true");
  };

  mobileMenuToggle?.addEventListener("click", (e)=>{
    if(!mobileBp.matches) return;
    e.preventDefault();
    if(document.body.classList.contains("menu-open")) closeMobileMenu();
    else openMobileMenu();
  });

  mobileMenuBackdrop?.addEventListener("click", closeMobileMenu);
  mobileLinks.forEach(link=>link.addEventListener("click", closeMobileMenu));
  window.addEventListener("resize", ()=>{
    if(!mobileBp.matches) closeMobileMenu();
    renderArtists();
  });
  document.addEventListener("keydown", (e)=>{
    if(e.key === "Escape"){
      closeMobileMenu();
    }
  });

  // Init
  $("#year").textContent = new Date().getFullYear();
  renderEvents();
  renderCal();
  clearPicked();
  renderArtists();
  renderReleases();
  renderStreams();
  renderMerch();
</script>


</body></html>
